{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/stamp/stamp.css' %}">
<title>stamp</title>
{% endblock %}

{% block content %}
<div>
    <canvas id="stamp-sheet" width="1080" height="1920"></canvas>
</div>

<script>
    const render = async (ctx) => {
        const stampOffsets = [
            { x: 662, y: 162 },
            { x: 213, y: 452 },
            { x: 662, y: 742 },
            { x: 213, y: 1032 },
            { x: 662, y: 1322 },
        ];

        const sheetSrc = "{% static 'image/stamp/sheet.png' %}";
        const stampSrc = "{% static 'image/stamp/stamp.png' %}";
        const sheetImg = await loadImage(sheetSrc);
        const stampImg = await loadImage(stampSrc);
        ctx.drawImage(sheetImg, 0, 0);

        const True = true;
        const False = false;
        {% autoescape off %}
        const isHaveStamp = {{ stamps }}
        {% endautoescape %}
        isHaveStamp.pop()

        isHaveStamp.forEach((stamp, index) => {
            stamp && ctx.drawImage(stampImg, stampOffsets[index].x, stampOffsets[index].y);
        })
    }

    const loadImage = (src) => {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.src = src;
            img.onload = () => {
                resolve(img);
            };
            img.onerror = () => {
                reject(new Error(`Failed to load image's URL: ${src}`));
            };
        });
    };

    const sheet = document.getElementById("stamp-sheet");
    const ctx = sheet.getContext("2d");
    render(ctx);
</script>
{% endblock %}